//-------------------------------------------------------------------------
//
// The MIT License (MIT)
//
// Copyright (c) 2013 Andrew Duncan
//
// Permission is hereby granted, free of charge, to any person obtaining a
// copy of this software and associated documentation files (the
// "Software"), to deal in the Software without restriction, including
// without limitation the rights to use, copy, modify, merge, publish,
// distribute, sublicense, and/or sell copies of the Software, and to
// permit persons to whom the Software is furnished to do so, subject to
// the following conditions:
//
// The above copyright notice and this permission notice shall be included
// in all copies or substantial portions of the Software.
//
// THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS
// OR IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF
// MERCHANTABILITY, FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT.
// IN NO EVENT SHALL THE AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY
// CLAIM, DAMAGES OR OTHER LIABILITY, WHETHER IN AN ACTION OF CONTRACT,
// TORT OR OTHERWISE, ARISING FROM, OUT OF OR IN CONNECTION WITH THE
// SOFTWARE OR THE USE OR OTHER DEALINGS IN THE SOFTWARE.
//
//-------------------------------------------------------------------------

#include "bits.h"
#include "font.h"

//-------------------------------------------------------------------------

uint8_t font[256][FONT_HEIGHT] =
{
    {0xe3, 0x71, 0x80, 0xe3, 0x00},// NULL
    {0x91, 0x62, 0xf0, 0x20, 0xf0},// SOH
    {0x91, 0x62, 0xd0, 0x20, 0xd0},// STX
    {0x81, 0xc3, 0xe1, 0xc3, 0x81},// ETX
    {0xe3, 0xa2, 0x80, 0xf0, 0x80},// EOT
    {0x2, 0x5, 0x2, 0x0, 0x0},// degree
    {0xe1, 0x42, 0xf1, 0x20, 0xd0},// ACK
    {0xe3, 0xa2, 0x63, 0xf0, 0x00},// BEL
    {0xe3, 0xa2, 0x41, 0xb0, 0x00},// BS
    {0xe3, 0xf2, 0xa0, 0x50, 0x00},// TAB
    {0xe3, 0x20, 0xf0, 0xa0, 0x00},// LF
    {0xc3, 0x20, 0xc3, 0xf0, 0x80},// VT
    {0xe3, 0x82, 0x00, 0xf0, 0xa0},// FF
    {0xc1, 0x22, 0xf2, 0xa0, 0xd0},// CR
    {0x91, 0x62, 0x70, 0x80, 0x70},// SO
    {0x91, 0x62, 0x80, 0xf0, 0x80},// SI
    {0xf3, 0x12, 0xf1, 0xa0, 0x80},// DLE   0x10
    {0xf3, 0x12, 0xe1, 0x00, 0xf0},// DC1
    {0xf3, 0x12, 0xe1, 0xb0, 0xc0},// DC2
    {0xf3, 0x12, 0xe1, 0xa0, 0xf0},// DC3
    {0xf3, 0x12, 0xf1, 0x50, 0x90},// DC4
    {0xe3, 0x71, 0xa0, 0xf3, 0x40},// NAK
    {0x91, 0x62, 0xc0, 0x30, 0xc0},// SYN
    {0xe3, 0xa2, 0xf0, 0xa0, 0x50},// ETB
    {0xc1, 0x22, 0x72, 0x90, 0x70},// CAN
    {0xe3, 0xb2, 0x40, 0x40, 0xb0},// EM
    {0x91, 0x62, 0xf0, 0xa0, 0x50},// SUB
    {0xe3, 0xa2, 0x40, 0xa0, 0x90},// ESC
    {0xe3, 0x82, 0x40, 0xa0, 0x90},// FS
    {0xc1, 0x22, 0xe2, 0xa0, 0x90},// GS
    {0xe3, 0x82, 0x61, 0xa0, 0x90},// RS
    {0xc3, 0x20, 0x20, 0xe3, 0x90},// US
 {0x00, 0x00, 0x00, 0x00, 0x00} // 0x20
  ,{0x00, 0x00, 0x5f, 0x00, 0x00} // 0x21 !
  ,{0x00, 0x07, 0x00, 0x07, 0x00} // 0x22 "
  ,{0x14, 0x7f, 0x14, 0x7f, 0x14} // 0x23 #
  ,{0x24, 0x2a, 0x7f, 0x2a, 0x12} // 0x24 $
  ,{0x23, 0x13, 0x08, 0x64, 0x62} // 0x25 %
  ,{0x36, 0x49, 0x55, 0x22, 0x50} // 0x26 &
  ,{0x00, 0x05, 0x03, 0x00, 0x00} // 0x27 '
  ,{0x00, 0x1c, 0x22, 0x41, 0x00} // 0x28 (
  ,{0x00, 0x41, 0x22, 0x1c, 0x00} // 0x29 )
  ,{0x14, 0x08, 0x3e, 0x08, 0x14} // 0x2a *
  ,{0x08, 0x08, 0x3e, 0x08, 0x08} // 0x2b +
  ,{0x00, 0x50, 0x30, 0x00, 0x00} // 0x2c ,
  ,{0x08, 0x08, 0x08, 0x08, 0x08} // 0x2d -
  ,{0x00, 0x60, 0x60, 0x00, 0x00} // 0x2e .
  ,{0x20, 0x10, 0x08, 0x04, 0x02} // 0x2f /
  ,{0x3e, 0x51, 0x49, 0x45, 0x3e} // 0x30 0
  ,{0x00, 0x42, 0x7f, 0x40, 0x00} // 0x31 1
  ,{0x42, 0x61, 0x51, 0x49, 0x46} // 0x32 2
  ,{0x21, 0x41, 0x45, 0x4b, 0x31} // 0x33 3
  ,{0x18, 0x14, 0x12, 0x7f, 0x10} // 0x34 4
  ,{0x27, 0x45, 0x45, 0x45, 0x39} // 0x35 5
  ,{0x3c, 0x4a, 0x49, 0x49, 0x30} // 0x36 6
  ,{0x01, 0x71, 0x09, 0x05, 0x03} // 0x37 7
  ,{0x36, 0x49, 0x49, 0x49, 0x36} // 0x38 8
  ,{0x06, 0x49, 0x49, 0x29, 0x1e} // 0x39 9
  ,{0x00, 0x36, 0x36, 0x00, 0x00} // 0x3a :
  ,{0x00, 0x56, 0x36, 0x00, 0x00} // 0x3b ;
  ,{0x08, 0x14, 0x22, 0x41, 0x00} // 0x3c <
  ,{0x14, 0x14, 0x14, 0x14, 0x14} // 0x3d =
  ,{0x00, 0x41, 0x22, 0x14, 0x08} // 0x3e >
  ,{0x02, 0x01, 0x51, 0x09, 0x06} // 0x3f ?
  ,{0x32, 0x49, 0x79, 0x41, 0x3e} // 0x40 @
  ,{0x7e, 0x11, 0x11, 0x11, 0x7e} // 0x41 A
  ,{0x7f, 0x49, 0x49, 0x49, 0x36} // 0x42 B
  ,{0x3e, 0x41, 0x41, 0x41, 0x22} // 0x43 C
  ,{0x7f, 0x41, 0x41, 0x22, 0x1c} // 0x44 D
  ,{0x7f, 0x49, 0x49, 0x49, 0x41} // 0x45 E
  ,{0x7f, 0x09, 0x09, 0x09, 0x01} // 0x46 F
  ,{0x3e, 0x41, 0x49, 0x49, 0x7a} // 0x47 G
  ,{0x7f, 0x08, 0x08, 0x08, 0x7f} // 0x48 H
  ,{0x00, 0x41, 0x7f, 0x41, 0x00} // 0x49 I
  ,{0x20, 0x40, 0x41, 0x3f, 0x01} // 0x4a J
  ,{0x7f, 0x08, 0x14, 0x22, 0x41} // 0x4b K
  ,{0x7f, 0x40, 0x40, 0x40, 0x40} // 0x4c L
  ,{0x7f, 0x02, 0x0c, 0x02, 0x7f} // 0x4d M
  ,{0x7f, 0x04, 0x08, 0x10, 0x7f} // 0x4e N
  ,{0x3e, 0x41, 0x41, 0x41, 0x3e} // 0x4f O
  ,{0x7f, 0x09, 0x09, 0x09, 0x06} // 0x50 P
  ,{0x3e, 0x41, 0x51, 0x21, 0x5e} // 0x51 Q
  ,{0x7f, 0x09, 0x19, 0x29, 0x46} // 0x52 R
  ,{0x46, 0x49, 0x49, 0x49, 0x31} // 0x53 S
  ,{0x01, 0x01, 0x7f, 0x01, 0x01} // 0x54 T
  ,{0x3f, 0x40, 0x40, 0x40, 0x3f} // 0x55 U
  ,{0x1f, 0x20, 0x40, 0x20, 0x1f} // 0x56 V
  ,{0x3f, 0x40, 0x38, 0x40, 0x3f} // 0x57 W
  ,{0x63, 0x14, 0x08, 0x14, 0x63} // 0x58 X
  ,{0x07, 0x08, 0x70, 0x08, 0x07} // 0x59 Y
  ,{0x61, 0x51, 0x49, 0x45, 0x43} // 0x5a Z
  ,{0x00, 0x7f, 0x41, 0x41, 0x00} // 0x5b [
  ,{0x02, 0x04, 0x08, 0x10, 0x20} // 0x5c \ (keep this to escape the backslash)
  ,{0x00, 0x41, 0x41, 0x7f, 0x00} // 0x5d ]
  ,{0x04, 0x02, 0x01, 0x02, 0x04} // 0x5e ^
  ,{0x40, 0x40, 0x40, 0x40, 0x40} // 0x5f _
  ,{0x00, 0x01, 0x02, 0x04, 0x00} // 0x60 `
  ,{0x20, 0x54, 0x54, 0x54, 0x78} // 0x61 a
  ,{0x7f, 0x48, 0x44, 0x44, 0x38} // 0x62 b
  ,{0x38, 0x44, 0x44, 0x44, 0x20} // 0x63 c
  ,{0x38, 0x44, 0x44, 0x48, 0x7f} // 0x64 d
  ,{0x38, 0x54, 0x54, 0x54, 0x18} // 0x65 e
  ,{0x08, 0x7e, 0x09, 0x01, 0x02} // 0x66 f
  ,{0x0c, 0x52, 0x52, 0x52, 0x3e} // 0x67 g
  ,{0x7f, 0x08, 0x04, 0x04, 0x78} // 0x68 h
  ,{0x00, 0x44, 0x7d, 0x40, 0x00} // 0x69 i
  ,{0x20, 0x40, 0x44, 0x3d, 0x00} // 0x6a j
  ,{0x7f, 0x10, 0x28, 0x44, 0x00} // 0x6b k
  ,{0x00, 0x41, 0x7f, 0x40, 0x00} // 0x6c l
  ,{0x7c, 0x04, 0x18, 0x04, 0x78} // 0x6d m
  ,{0x7c, 0x08, 0x04, 0x04, 0x78} // 0x6e n
  ,{0x38, 0x44, 0x44, 0x44, 0x38} // 0x6f o
  ,{0x7c, 0x14, 0x14, 0x14, 0x08} // 0x70 p
  ,{0x08, 0x14, 0x14, 0x18, 0x7c} // 0x71 q
  ,{0x7c, 0x08, 0x04, 0x04, 0x08} // 0x72 r
  ,{0x48, 0x54, 0x54, 0x54, 0x20} // 0x73 s
  ,{0x04, 0x3f, 0x44, 0x40, 0x20} // 0x74 t
  ,{0x3c, 0x40, 0x40, 0x20, 0x7c} // 0x75 u
  ,{0x1c, 0x20, 0x40, 0x20, 0x1c} // 0x76 v
  ,{0x3c, 0x40, 0x30, 0x40, 0x3c} // 0x77 w
  ,{0x44, 0x28, 0x10, 0x28, 0x44} // 0x78 x
  ,{0x0c, 0x50, 0x50, 0x50, 0x3c} // 0x79 y
  ,{0x44, 0x64, 0x54, 0x4c, 0x44} // 0x7a z
  ,{0x00, 0x08, 0x36, 0x41, 0x00} // 0x7b {
  ,{0x00, 0x00, 0x7f, 0x00, 0x00} // 0x7c |
  ,{0x00, 0x41, 0x36, 0x08, 0x00} // 0x7d }
  ,{0x10, 0x08, 0x08, 0x10, 0x08} // 0x7e ~
  ,{0x78, 0x46, 0x41, 0x46, 0x78} // 0x7f DEL
};

//-------------------------------------------------------------------------

void
drawCharIndexed(
    int x,
    int y,
    uint8_t c,
    int8_t index,
    IMAGE_T *image)
{
    int j;
    for (j = 0 ; j < FONT_HEIGHT ; j++)
    {
        uint8_t byte = font[c][j];

        if (byte != 0)
        {
            int i;
            for (i = 0 ; i < FONT_WIDTH ; ++i)
            {
                if ((byte >> (FONT_WIDTH - i - 1)) & 1 )
                {
                    setPixelIndexed(image, x + i, y + j, index);
                }
            }
        }
    }
}

//-------------------------------------------------------------------------

void
drawCharRGB(
    int x,
    int y,
    uint8_t c,
    const RGBA8_T *rgb,
    IMAGE_T *image)
{
    int j;
    for (j = 0 ; j < FONT_WIDTH ; j++)
    {
        uint8_t byte = font[c][j];

        if (byte != 0)
        {
            int i;
            for (i = 0 ; i < FONT_HEIGHT ; ++i)
            {
                if ((byte >> (FONT_HEIGHT - i - 1)) & 1 )
                {
                    setPixelRGB(image, x + j, y + FONT_HEIGHT - i, rgb);
                }
            }
        }
    }
}

//-------------------------------------------------------------------------

void
drawStringIndexed(
    int x,
    int y,
    const char *string,
    int8_t index,
    IMAGE_T *image)
{
    if (string == NULL)
    {
        return;
    }

    int x_first = x;

    while (*string != '\0')
    {
        if (*string == '\n')
        {
            x = x_first;
            y += FONT_HEIGHT;
        }
        else
        {
            drawCharIndexed(x, y, *string, index, image);
            x += FONT_WIDTH;
        }
        ++string;
    }
}

//-------------------------------------------------------------------------

void
drawStringRGB(
    int x,
    int y,
    const char *string,
    const RGBA8_T *rgb,
    IMAGE_T *image)
{
    if (string == NULL)
    {
        return;
    }

    int x_first = x;

    while (*string != '\0')
    {
        if (*string == '\n')
        {
            x = x_first;
            y += FONT_HEIGHT;
        }
        else
        {
            drawCharRGB(x, y, *string, rgb, image);
            x += FONT_WIDTH;
        }
        ++string;
    }
}
